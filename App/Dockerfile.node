FROM node:20.11.0-alpine3.19 AS builder

WORKDIR /build
ENV NODE_ENV=production

COPY package*.json ./

RUN npm ci --only=production --no-optional && \
    npm cache clean --force

FROM gcr.io/distroless/nodejs20-debian12

WORKDIR /app
COPY --from=builder /build/node_modules /app/node_modules

COPY socket-server.js server.js package.json ./

EXPOSE 3000

CMD ["socket-server.js"] 