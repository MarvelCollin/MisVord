<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoSDK Web Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        .debug { background: #333; padding: 10px; border-radius: 5px; margin: 10px 0; }
        pre { background: #444; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>VideoSDK Configuration Test (Web Context)</h1>
    
    <div id="test-results">
        <p class="info">Loading test results...</p>
    </div>
    
    <button onclick="testVideoSDKAPI()">Test VideoSDK API</button>
    <button onclick="runTests()">Re-run Tests</button>
    
    <div id="api-results" style="margin-top: 20px;"></div>

    <script>
        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p class="info">Running tests...</p>';
            
            try {
                const response = await fetch('/api/test-videosdk.php');
                const data = await response.json();
                
                let html = '<h2>Test Results</h2>';
                
                if (data.success) {
                    html += '<p class="success">✓ VideoSDK Configuration Successful</p>';
                    html += '<div class="debug"><h3>Configuration:</h3>';
                    html += `<p>API Key: ${data.config.apiKey ? '[SET]' : '[NOT SET]'}</p>`;
                    html += `<p>Token: ${data.config.token}</p>`;
                    html += `<p>Production Mode: ${data.config.isProduction}</p>`;
                    html += '</div>';
                } else {
                    html += '<p class="error">✗ VideoSDK Configuration Failed</p>';
                    if (data.error) {
                        html += `<p class="error">Error: ${data.error}</p>`;
                    }
                }
                
                if (data.debug) {
                    html += '<div class="debug"><h3>Debug Information:</h3>';
                    html += `<p><strong>Working Directory:</strong> ${data.debug.working_directory}</p>`;
                    html += `<p><strong>Script Path:</strong> ${data.debug.script_path}</p>`;
                    html += `<p><strong>Document Root:</strong> ${data.debug.document_root}</p>`;
                    html += `<p><strong>APP_ROOT Defined:</strong> ${data.debug.app_root_defined}</p>`;
                    
                    if (data.debug.app_root_value) {
                        html += `<p><strong>APP_ROOT Value:</strong> ${data.debug.app_root_value}</p>`;
                    }
                    
                    if (data.debug.config_path_used) {
                        html += `<p><strong>Config Path Used:</strong> ${data.debug.config_path_used}</p>`;
                    }
                    
                    if (data.debug.paths) {
                        html += '<h4>Path Resolution Attempts:</h4>';
                        for (const [name, pathInfo] of Object.entries(data.debug.paths)) {
                            const status = pathInfo.exists ? '✓' : '✗';
                            const cssClass = pathInfo.exists ? 'success' : 'error';
                            html += `<p class="${cssClass}">${status} ${name}: ${pathInfo.path}</p>`;
                        }
                    }
                    
                    if (data.debug.error_trace) {
                        html += '<h4>Error Details:</h4>';
                        html += `<p><strong>File:</strong> ${data.debug.error_file}</p>`;
                        html += `<p><strong>Line:</strong> ${data.debug.error_line}</p>`;
                        html += '<pre>' + data.debug.error_trace + '</pre>';
                    }
                    
                    html += '</div>';
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">✗ Failed to run tests: ${error.message}</p>`;
            }
        }
        
        async function testVideoSDKAPI() {
            const apiDiv = document.getElementById('api-results');
            apiDiv.innerHTML = '<p class="info">Testing VideoSDK API...</p>';
            
            try {
                const response = await fetch('/api/videosdk-token.php');
                const data = await response.json();
                
                let html = '<h2>VideoSDK API Test Results</h2>';
                
                if (data.success) {
                    html += '<p class="success">✓ VideoSDK API Working</p>';
                    html += '<div class="debug">';
                    html += `<p><strong>API Key:</strong> ${data.apiKey ? '[SET]' : '[NOT SET]'}</p>`;
                    html += `<p><strong>Token:</strong> ${data.token ? '[SET]' : '[NOT SET]'}</p>`;
                    html += '</div>';
                } else {
                    html += '<p class="error">✗ VideoSDK API Failed</p>';
                    if (data.error) {
                        html += `<p class="error">Error: ${data.error}</p>`;
                    }
                }
                
                apiDiv.innerHTML = html;
                
            } catch (error) {
                apiDiv.innerHTML = `<p class="error">✗ API test failed: ${error.message}</p>`;
            }
        }
        
        // Run tests on page load
        runTests();
    </script>
</body>
</html>
